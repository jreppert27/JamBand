{# templates/_post.html #}
<div class="pin-card">
  <!-- Card: clicking opens the modal -->
  <div class="card shadow-sm h-100"
       data-bs-toggle="modal"
       data-bs-target="#postModal-{{ post.id }}"
       style="cursor: pointer;">
    {% if post.media_path %}
      <img
        src="{{ url_for('static', filename='uploads/' ~ post.media_path) }}"
        class="card-img-top"
        style="object-fit: cover; max-height: 200px;"
        alt="Post media"
      >
    {% endif %}
    <div class="card-body">
      <h5 class="card-title">{{ post.header }}</h5>
      <p class="card-text">{{ post.body }}</p>
      <small class="text-muted">{{ post.timestamp.strftime('%b %d, %Y') }}</small>
    </div>
  </div>
</div>

<!-- Modal for this post -->
<div class="modal fade" id="postModal-{{ post.id }}" tabindex="-1"
     aria-labelledby="postModalLabel-{{ post.id }}" aria-hidden="true">
  <div class="modal-dialog modal-lg modal-dialog-centered">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="postModalLabel-{{ post.id }}">
          {{ post.header }}
        </h5>
        <button type="button" class="btn-close"
                data-bs-dismiss="modal" aria-label="Close"></button>
      </div>
      <div class="modal-body">
        {% if post.media_path %}
          <img
            src="{{ url_for('static', filename='uploads/' ~ post.media_path) }}"
            class="img-fluid mb-3"
            style="object-fit: cover; max-height:400px; width:100%;"
            alt="Post media"
          >
        {% endif %}
        <p>{{ post.body }}</p>
        <hr>
        <h6>Comments</h6>
        <ul class="list-group mb-3">
          {% for comment in post.comments %}
            <li class="list-group-item">
              <strong>
                <a href="{{ url_for('user', username=comment.author.username) }}">
                  {{ comment.author.username }}
                </a>
              </strong>
              <small class="text-muted ms-2">
                {{ comment.timestamp.strftime('%b %d, %Y %H:%M') }}
              </small>
              <p class="mb-0">{{ comment.body }}</p>
            </li>
          {% else %}
            <li class="list-group-item text-muted">No comments yet.</li>
          {% endfor %}
        </ul>

        {% if current_user.is_authenticated %}
        <form action="{{ url_for('comment_post', post_id=post.id) }}"
              method="post">
          <div class="mb-3">
            <textarea name="comment_body" class="form-control" rows="3"
                      placeholder="Add a comment..." required></textarea>
          </div>
          <button type="submit" class="btn btn-primary">Submit Comment</button>
        </form>
        {% endif %}
      </div>
    </div>
  </div>
</div>
